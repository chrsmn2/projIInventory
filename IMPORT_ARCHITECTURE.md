# Arsitektur Fitur Import Master Item

## ğŸ”„ Import Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Show Import Form     â”‚         â”‚ Download Template    â”‚     â”‚
â”‚  â”‚ GET /items/import    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ GET /download-       â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚ template             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                 â–²                   â”‚
â”‚           â”‚ Display Form                    â”‚ Excel File        â”‚
â”‚           â–¼                                  â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Import Form (import.blade.php)                       â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ File Upload (drag & drop)                  â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ - Accepts: .xlsx, .xls, .csv              â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ - Max size: 2MB                            â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ [Import Items Button]                      â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                                                     â”‚
â”‚           â”‚ POST /items/import { file }                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ItemController::import()                        â”‚
â”‚                                                                  â”‚
â”‚  1. Validate file                                               â”‚
â”‚  2. Create ItemsImport instance                                 â”‚
â”‚  3. Excel::import($import, $request->file('file'))              â”‚
â”‚  4. Get imported count & errors                                 â”‚
â”‚  5. Redirect with messages                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ItemsImport (app/Imports/ItemsImport.php)          â”‚
â”‚                                                                  â”‚
â”‚  Implements:                                                    â”‚
â”‚  - ToModel                                                      â”‚
â”‚  - WithHeadingRow                                              â”‚
â”‚  - WithBatchInserts (100 rows)                                 â”‚
â”‚  - WithChunkReading (100 rows)                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  model(array $row)                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Skip empty rows                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Validate required fields                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Get or Create Category (with auto-generated code)   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Get or Create Unit (with auto-generated code)       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Validate condition (good|damaged)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Validate numeric fields                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ Generate unique item_code                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Create Item in DB transaction                        â”‚  â”‚
â”‚  â”‚  â””â”€ Track errors if any                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼              â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Items  â”‚   â”‚Categoriesâ”‚   â”‚Units   â”‚   â”‚  Logs   â”‚
        â”‚ Table  â”‚   â”‚ Table    â”‚   â”‚ Table  â”‚   â”‚ (Errors)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Return to Controller    â”‚
        â”‚  with counts & errors    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Redirect to admin.items.index                          â”‚
â”‚                                                                  â”‚
â”‚  with:                                                           â”‚
â”‚  - 'success' â†’ "X item(s) imported successfully"                 â”‚
â”‚  - 'warning' â†’ "Some rows were skipped: ..." (if errors)        â”‚
â”‚  - 'error' â†’ "Import failed: ..." (if exception)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Master Items Page   â”‚
        â”‚  (Updated list)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Database Transaction Flow

```
For Each Row in Excel:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DB::transaction(function() {      â”‚
â”‚                                     â”‚
â”‚   1. Validate Row                   â”‚
â”‚      â”œâ”€ Check required fields       â”‚
â”‚      â”œâ”€ Check field formats         â”‚
â”‚      â””â”€ Check constraints           â”‚
â”‚      â”‚                              â”‚
â”‚      â”œâ”€ FAIL? â”€â”€â–¶ Throw Exception   â”‚
â”‚      â”‚           Return null        â”‚
â”‚      â””â”€ OK? â”€â”€â”€â–¶ Continue            â”‚
â”‚                                     â”‚
â”‚   2. Category Management            â”‚
â”‚      â””â”€ Category::firstOrCreate()   â”‚
â”‚         â”œâ”€ Exists? Use existing     â”‚
â”‚         â””â”€ New? Create with code    â”‚
â”‚                                     â”‚
â”‚   3. Unit Management                â”‚
â”‚      â””â”€ Unit::firstOrCreate()       â”‚
â”‚         â”œâ”€ Exists? Use existing     â”‚
â”‚         â””â”€ New? Create with code    â”‚
â”‚                                     â”‚
â”‚   4. Validation                     â”‚
â”‚      â”œâ”€ Check item_name uniqueness  â”‚
â”‚      â”œâ”€ Validate condition enum     â”‚
â”‚      â””â”€ Validate numeric fields     â”‚
â”‚      â”‚                              â”‚
â”‚      â”œâ”€ FAIL? â”€â”€â–¶ Throw Exception   â”‚
â”‚      â”‚           Catch & Log        â”‚
â”‚      â””â”€ OK? â”€â”€â”€â–¶ Continue            â”‚
â”‚                                     â”‚
â”‚   5. Generate Item Code             â”‚
â”‚      â”œâ”€ Get category code           â”‚
â”‚      â”œâ”€ Find max sequential number  â”‚
â”‚      â””â”€ Create unique code          â”‚
â”‚                                     â”‚
â”‚   6. Create Item                    â”‚
â”‚      â””â”€ Item::create([...])         â”‚
â”‚         â”œâ”€ Success? Track count     â”‚
â”‚         â””â”€ Error? Catch exception   â”‚
â”‚                                     â”‚
â”‚   })  // End transaction            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Success: Row saved
âŒ Error: Row rolled back (not saved)
               â”‚
               â–¼
        Continue to next row
```

## ğŸ—ï¸ Architecture Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Routes (routes/web.php)                               â”‚
â”‚  â”œâ”€ GET /items/import/show â†’ showImport()              â”‚
â”‚  â”œâ”€ POST /items/import â†’ import()                      â”‚
â”‚  â””â”€ GET /items/download-template â†’ downloadTemplate()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Controller Layer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ItemController (app/Http/Controllers/Admin/)          â”‚
â”‚  â”œâ”€ showImport() â†’ View form                           â”‚
â”‚  â”œâ”€ import() â†’ Process upload                          â”‚
â”‚  â””â”€ downloadTemplate() â†’ Generate Excel                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Logic Layer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ItemsImport (app/Imports/)                            â”‚
â”‚  â”œâ”€ model() â†’ Process row                              â”‚
â”‚  â”œâ”€ validateRow() â†’ Field validation                   â”‚
â”‚  â”œâ”€ generateCategoryCode() â†’ Auto-generate             â”‚
â”‚  â”œâ”€ generateUnitCode() â†’ Auto-generate                 â”‚
â”‚  â””â”€ generateItemCode() â†’ Auto-generate                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Access Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Models                                                â”‚
â”‚  â”œâ”€ Item::create()                                     â”‚
â”‚  â”œâ”€ Category::firstOrCreate()                          â”‚
â”‚  â”œâ”€ Unit::firstOrCreate()                              â”‚
â”‚  â””â”€ DB::transaction()                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database Layer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tables                                                â”‚
â”‚  â”œâ”€ items                                              â”‚
â”‚  â”œâ”€ categories                                         â”‚
â”‚  â””â”€ units                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ Key Classes & Methods

```
ItemsImport
â”œâ”€ model(array $row): Item|null
â”‚  â””â”€ Process individual row
â”œâ”€ validateRow(array $row): void
â”‚  â””â”€ Validate required fields
â”œâ”€ generateCategoryCode(string $name): string
â”‚  â””â”€ Generate unique category code
â”œâ”€ generateUnitCode(string $name): string
â”‚  â””â”€ Generate unique unit code
â”œâ”€ generateItemCode(Category $category): string
â”‚  â””â”€ Generate unique item code per category
â”œâ”€ getImportedCount(): int
â”‚  â””â”€ Return count of successful imports
â””â”€ getErrors(): array
   â””â”€ Return array of errors

ItemController
â”œâ”€ showImport(): View
â”‚  â””â”€ Display import form
â”œâ”€ import(Request $request): Redirect
â”‚  â””â”€ Process file upload
â””â”€ downloadTemplate(): Response
   â””â”€ Generate Excel template
```

## ğŸ” Security Flow

```
Request â†’ Controller
   â”‚
   â”œâ”€ [1] Authenticate (middleware auth)
   â”‚       â””â”€ Verify user is logged in
   â”‚
   â”œâ”€ [2] Authorize (middleware role:admin)
   â”‚       â””â”€ Verify user is admin
   â”‚
   â”œâ”€ [3] Validate Request
   â”‚       â””â”€ File must be xlsx|xls|csv
   â”‚       â””â”€ File must not exceed 2MB
   â”‚
   â”œâ”€ [4] Process File
   â”‚       â””â”€ Read Excel safely
   â”‚       â””â”€ Validate each row
   â”‚       â””â”€ Use parameterized queries
   â”‚
   â””â”€ [5] Return Response
           â””â”€ Redirect with safe messages
```

## âš¡ Performance Optimization

```
Large File Import:

1. Batch Insertion (100 rows)
   â””â”€ Better than single insert
   â””â”€ Reduces DB round-trips
   â””â”€ Maintains query size limits

2. Chunk Reading (100 rows)
   â””â”€ Avoid loading entire file to memory
   â””â”€ Process in chunks
   â””â”€ Suitable for large files (1000+ rows)

3. Transaction per Row
   â””â”€ Isolation level: READ_COMMITTED
   â””â”€ No full table locking
   â””â”€ Other users can read during import

Performance Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 100 rows   : ~2-3 seconds           â”‚
â”‚ 500 rows   : ~10-15 seconds         â”‚
â”‚ 1000 rows  : ~20-30 seconds         â”‚
â”‚ 5000 rows  : ~100-150 seconds       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Error Handling Strategy

```
Error Handling Flow:

Excel File
    â”‚
    â–¼
Row Validation
    â”‚
    â”œâ”€ INVALID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           â”‚
    â”‚ - Catch Exception         â”‚
    â”‚ - Log Error Details       â”‚
    â”‚ - Add to errors array     â”‚
    â”‚ - Return null             â”‚
    â”‚ - Continue to next row â—„â”€â”€â”˜
    â”‚
    â””â”€ VALID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚
    DB Transaction Start â—„â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ Create/Update Relations
        â”‚   (Category, Unit)
        â”‚
        â”œâ”€ Validate Constraints
        â”‚   (Uniqueness, Enums)
        â”‚
        â”œâ”€ Create Item â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   (Success)           â”‚
        â”‚   - Commit            â”‚
        â”‚   - Increment count   â”‚
        â”‚   - Continue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
        â”‚                       â”‚  â”‚
        â”‚   (Failure)           â”‚  â”‚
        â”‚   - Rollback          â”‚  â”‚
        â”‚   - Log Error         â”‚  â”‚
        â”‚   - Continue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤
        â”‚                       â”‚  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
                                â”‚
                      Next Row â—„â”˜
```

## ğŸ¯ Success Criteria

```
Import Success = All rows processed without fatal error

Partial Success:
- Some rows imported âœ…
- Some rows failed âŒ
- Result: Show both counts

Total Success:
- All rows imported âœ…
- Zero failures
- Result: Show total count only

Failure:
- File cannot be read
- System error occurred
- Result: Show error message
```

---

**Diagram Version:** 1.0  
**Updated:** February 2, 2026
